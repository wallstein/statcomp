<!DOCTYPE html>
<html lang="en"><head>
<script src="09_multilevel_files/libs/clipboard/clipboard.min.js"></script>
<script src="09_multilevel_files/libs/quarto-html/tabby.min.js"></script>
<script src="09_multilevel_files/libs/quarto-html/popper.min.js"></script>
<script src="09_multilevel_files/libs/quarto-html/tippy.umd.min.js"></script>
<link href="09_multilevel_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="09_multilevel_files/libs/quarto-html/quarto-html.min.css" rel="stylesheet" data-mode="light">
<link href="09_multilevel_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.2.269">

  <meta name="author" content="David Rossell">
  <title>Modern Statistical Computing</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="09_multilevel_files/libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="09_multilevel_files/libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      { color: #003b4f; background-color: #f1f3f5; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #003b4f; } /* Normal */
    code span.al { color: #ad0000; } /* Alert */
    code span.an { color: #5e5e5e; } /* Annotation */
    code span.at { color: #657422; } /* Attribute */
    code span.bn { color: #ad0000; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #003b4f; } /* ControlFlow */
    code span.ch { color: #20794d; } /* Char */
    code span.cn { color: #8f5902; } /* Constant */
    code span.co { color: #5e5e5e; } /* Comment */
    code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
    code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
    code span.dt { color: #ad0000; } /* DataType */
    code span.dv { color: #ad0000; } /* DecVal */
    code span.er { color: #ad0000; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #ad0000; } /* Float */
    code span.fu { color: #4758ab; } /* Function */
    code span.im { color: #00769e; } /* Import */
    code span.in { color: #5e5e5e; } /* Information */
    code span.kw { color: #003b4f; } /* Keyword */
    code span.op { color: #5e5e5e; } /* Operator */
    code span.ot { color: #003b4f; } /* Other */
    code span.pp { color: #ad0000; } /* Preprocessor */
    code span.sc { color: #5e5e5e; } /* SpecialChar */
    code span.ss { color: #20794d; } /* SpecialString */
    code span.st { color: #20794d; } /* String */
    code span.va { color: #111111; } /* Variable */
    code span.vs { color: #20794d; } /* VerbatimString */
    code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="09_multilevel_files/libs/revealjs/dist/theme/quarto.css" id="theme">
  <link href="09_multilevel_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="09_multilevel_files/libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="09_multilevel_files/libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="09_multilevel_files/libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">

  .callout {
    margin-top: 1em;
    margin-bottom: 1em;  
    border-radius: .25rem;
  }

  .callout.callout-style-simple { 
    padding: 0em 0.5em;
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
    display: flex;
  }

  .callout.callout-style-default {
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
  }

  .callout .callout-body-container {
    flex-grow: 1;
  }

  .callout.callout-style-simple .callout-body {
    font-size: 1rem;
    font-weight: 400;
  }

  .callout.callout-style-default .callout-body {
    font-size: 0.9rem;
    font-weight: 400;
  }

  .callout.callout-captioned.callout-style-simple .callout-body {
    margin-top: 0.2em;
  }

  .callout:not(.callout-captioned) .callout-body {
      display: flex;
  }

  .callout:not(.no-icon).callout-captioned.callout-style-simple .callout-content {
    padding-left: 1.6em;
  }

  .callout.callout-captioned .callout-header {
    padding-top: 0.2em;
    margin-bottom: -0.2em;
  }

  .callout.callout-captioned .callout-caption  p {
    margin-top: 0.5em;
    margin-bottom: 0.5em;
  }
    
  .callout.callout-captioned.callout-style-simple .callout-content  p {
    margin-top: 0;
  }

  .callout.callout-captioned.callout-style-default .callout-content  p {
    margin-top: 0.7em;
  }

  .callout.callout-style-simple div.callout-caption {
    border-bottom: none;
    font-size: .9rem;
    font-weight: 600;
    opacity: 75%;
  }

  .callout.callout-style-default  div.callout-caption {
    border-bottom: none;
    font-weight: 600;
    opacity: 85%;
    font-size: 0.9rem;
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-default div.callout-content {
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-simple .callout-icon::before {
    height: 1rem;
    width: 1rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 1rem 1rem;
  }

  .callout.callout-style-default .callout-icon::before {
    height: 0.9rem;
    width: 0.9rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 0.9rem 0.9rem;
  }

  .callout-caption {
    display: flex
  }
    
  .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  .callout.no-icon::before {
    display: none !important;
  }

  .callout.callout-captioned .callout-body > .callout-content > :last-child {
    margin-bottom: 0.5rem;
  }

  .callout.callout-captioned .callout-icon::before {
    margin-top: .5rem;
    padding-right: .5rem;
  }

  .callout:not(.callout-captioned) .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  /* Callout Types */

  div.callout-note {
    border-left-color: #4582ec !important;
  }

  div.callout-note .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEU0lEQVRYCcVXTWhcVRQ+586kSUMMxkyaElstCto2SIhitS5Ek8xUKV2poatCcVHtUlFQk8mbaaziwpWgglJwVaquitBOfhQXFlqlzSJpFSpIYyXNjBNiTCck7x2/8/LeNDOZxDuEkgOXe++553zfefee+/OYLOXFk3+1LLrRdiO81yNqZ6K9cG0P3MeFaMIQjXssE8Z1JzLO9ls20MBZX7oG8w9GxB0goaPrW5aNMp1yOZIa7Wv6o2ykpLtmAPs/vrG14Z+6d4jpbSKuhdcSyq9wGMPXjonwmESXrriLzFGOdDBLB8Y6MNYBu0dRokSygMA/mrun8MGFN3behm6VVAwg4WR3i6FvYK1T7MHo9BK7ydH+1uurECoouk5MPRyVSBrBHMYwVobG2aOXM07sWrn5qgB60rc6mcwIDJtQrnrEr44kmy+UO9r0u9O5/YbkS9juQckLed3DyW2XV/qWBBB3ptvI8EUY3I9p/67OW+g967TNr3Sotn3IuVlfMLVnsBwH4fsnebJvyGm5GeIUA3jljERmrv49SizPYuq+z7c2H/jlGC+Ghhupn/hcapqmcudB9jwJ/3jvnvu6vu5lVzF1fXyZuZZ7U8nRmVzytvT+H3kilYvH09mLWrQdwFSsFEsxFVs5fK7A0g8gMZjbif4ACpKbjv7gNGaD8bUrlk8x+KRflttr22JEMRUbTUwwDQScyzPgedQHZT0xnx7ujw2jfVfExwYHwOsDTjLdJ2ebmeQIlJ7neo41s/DrsL3kl+W2lWvAga0tR3zueGr6GL78M3ifH0rGXrBC2aAR8uYcIA5gwV8zIE8onoh8u0Fca/ciF7j1uOzEnqcIm59sEXoGc0+z6+H45V1CvAvHcD7THztu669cnp+L0okAeIc6zjbM/24LgGM1gZk7jnRu1aQWoU9sfUOuhrmtaPIO3YY1KLLWZaEO5TKUbMY5zx8W9UJ6elpLwKXbsaZ4EFl7B4bMtDv0iRipKoDQT2sNQI9b1utXFdYisi+wzZ/ri/1m7QfDgEuvgUUEIJPq3DhX/5DWNqIXDOweC2wvIR90Oq3lDpdMIgD2r0dXvGdsEW5H6x6HLRJYU7C69VefO1x8Gde1ZFSJLfWS1jbCnhtOPxmpfv2LXOA2Xk2tvnwKKPFuZ/oRmwBwqRQDcKNeVQkYcOjtWVBuM/JuYw5b6isojIkYxyYAFn5K7ZBF10fea52y8QltAg6jnMqNHFBmGkQ1j+U43HMi2xMar1Nv0zGsf1s8nUsmUtPOOrbFIR8bHFDMB5zL13Gmr/kGlCkUzedTzzmzsaJXhYawnA3UmARpiYj5ooJZiUoxFRtK3X6pgNPv+IZVPcnwbOl6f+aBaO1CNvPW9n9LmCp01nuSaTRF2YxHqZ8DYQT6WsXT+RD6eUztwYLZ8rM+rcPxamv1VQzFUkzFXvkiVrySGQgJNvXHJAxiU3/NwiC03rSf05VBaPtu/Z7/B8Yn/w7eguloAAAAAElFTkSuQmCC');
  }

  div.callout-note.callout-style-default .callout-caption {
    background-color: #dae6fb
  }

  div.callout-important {
    border-left-color: #d9534f !important;
  }

  div.callout-important .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEKklEQVRYCcVXTWhcVRS+575MJym48A+hSRFr00ySRQhURRfd2HYjk2SSTokuBCkU2o0LoSKKraKIBTcuFCoidGFD08nkBzdREbpQ1EDNIv8qSGMFUboImMSZd4/f9zJv8ibJMC8xJQfO3HPPPef7zrvvvnvviIkpC9nsw0UttFunbUhpFzFtarSd6WJkStVMw5xyVqYTvkwfzuf/5FgtkVoB0729j1rjXwThS7Vio+Mo6DNnvLfahoZ+i/o32lULuJ3NNiz7q6+pyAUkJaFF6JwaM2lUJlV0MlnQn5aTRbEu0SEqHUa0A4AdiGuB1kFXRfVyg5d87+Dg4DL6m2TLAub60ilj7A1Ec4odSAc8X95sHh7+ZRPCFo6Fnp7HfU/fBng/hi10CjCnWnJjsxvDNxWw0NfV6Rv5GgP3I3jGWXumdTD/3cbEOP2ZbOZp69yniG3FQ9z1jD7bnBu9Fc2tKGC2q+uAJOQHBDRiZX1x36o7fWBs7J9ownbtO+n0/qWkvW7UPIfc37WgT6ZGR++EOJyeQDSb9UB+DZ1G6DdLDzyS+b/kBCYGsYgJbSQHuThGKRcw5xdeQf8YdNHsc6ePXrlSYMBuSIAFTGAtQo+VuALo4BX83N190NWZWbynBjhOHsmNfFWLeL6v+ynsA58zDvvAC8j5PkbOcXCMg2PZFk3q8MjI7WAG/Dp9AwP7jdGBOOQkAvlFUB+irtm16I1Zw9YBcpGTGXYmk3kQIC/Cds55l+iMI3jqhjAuaoe+am2Jw5GT3Nbz3CkE12NavmzN5+erJW7046n/CH1RO/RVa8lBLozXk9uqykkGAyRXLWlLv5jyp4RFsG5vGVzpDLnIjTWgnRy2Rr+tDKvRc7Y8AyZq10jj8DqXdnIRNtFZb+t/ZRtXcDiVnzpqx8mPcDWxgARUqx0W1QB9MeUZiNrV4qP+Ehc+BpNgATsTX8ozYKL2NtFYAHc84fG7ndxUPr+AR/iQSns7uSUufAymwDOb2+NjK27lEFocm/EE2WpyIy/Hi66MWuMKJn8RvxIcj87IM5Vh9663ziW36kR0HNenXuxmfaD8JC7tfKbrhFr7LiZCrMjrzTeGx+PmkosrkNzW94ObzwocJ7A1HokLolY+AvkTiD/q1H0cN48c5EL8Crkttsa/AXQVDmutfyku0E7jShx49XqV3MFK8IryDhYVbj7Sj2P2eBxwcXoe8T8idsKKPRcnZw1b+slFTubwUwhktrfnAt7J++jwQtLZcm3sr9LQrjRzz6cfMv9aLvgmnAGvpoaGLxM4mAEaLV7iAzQ3oU0IvD5x9ix3yF2RAAuYAOO2f7PEFWCXZ4C9Pb2UsgDeVnFSpbFK7/IWu7TPTvBqzbGdCHOJQSxiEjt6IyZmxQyEJHv6xyQsYk//moVFsN2zP6fRImjfq7/n/wFDguUQFNEwugAAAABJRU5ErkJggg==');
  }

  div.callout-important.callout-style-default .callout-caption {
    background-color: #f7dddc
  }

  div.callout-warning {
    border-left-color: #f0ad4e !important;
  }

  div.callout-warning .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAETklEQVRYCeVWW2gcVRg+58yaTUnizqbipZeX4uWhBEniBaoUX1Ioze52t7sRq6APio9V9MEaoWlVsFasRq0gltaAPuxms8lu0gcviE/FFOstVbSIxgcv6SU7EZqmdc7v9+9mJtNks51NTUH84ed889/PP+cmxP+d5FIbMJmNbpREu4WUkiTtCicKny0l1pIKmBzovF2S+hIJHX8iEu3hZJ5lNZGqyRrGSIQpq15AzF28jgpeY6yk6GVdrfFqdrD6Iw+QlB8g0YS2g7dyQmXM/IDhBhT0UCiRf59lfqmmDvzRt6kByV/m4JjtzuaujMUM2c5Z2d6JdKrRb3K2q6mA+oYVz8JnDdKPmmNthzkAk/lN63sYPgevrguc72aZX/L9C6x09GYyxBgCX4NlvyGUHOKELlm5rXeR1kchuChJt4SSwyddZRXgvwMGvYo4QSlk3/zkHD8UHxwVJA6zjZZqP8v8kK8OWLnIZtLyCAJagYC4rTGW/9Pqj92N/c+LUaAj27movwbi19tk/whRCIE7Q9vyI6yvRpftAKVTdUjOW40X3h5OXsKCdmFcx0xlLJoSuQngnrJe7Kcjm4OMq9FlC7CMmScQANuNvjfP3PjGXDBaUQmbp296S5L4DrpbrHN1T87ZVEZVCzg1FF0Ft+dKrlLukI+/c9ENo+TvlTDbYFvuKPtQ9+l052rXrgKoWkDAFnvh0wTOmYn8R5f4k/jN/fZiCM1tQx9jQQ4ANhqG4hiL0qIFTGViG9DKB7GYzgubnpofgYRwO+DFjh0Zin2m4b/97EDkXkc+f6xYAPX0KK2I/7fUQuwzuwo/L3AkcjugPNixC8cHf0FyPjWlItmLxWw4Ou9YsQCr5fijMGoD/zpdRy95HRysyXA74MWOnscpO4j2y3HAVisw85hX5+AFBRSHt4ShfLFkIMXTqyKFc46xdzQM6XbAi702a7sy04J0+feReMFKp5q9esYLCqAZYw/k14E/xcLLsFElaornTuJB0svMuJINy8xkIYuL+xPAlWRceH6+HX7THJ0djLUom46zREu7tTkxwmf/FdOZ/sh6Q8qvEAiHpm4PJ4a/doJe0gH1t+aHRgCzOvBvJedEK5OFE5jpm4AGP2a8Dxe3gGJ/pAutug9Gp6he92CsSsWBaEcxGx0FHytmIpuqGkOpldqNYQK8cSoXvd+xLxXADw0kf6UkJNFtdo5MOgaLjiQOQHcn+A6h5NuL2s0qsC2LOM75PcF3yr5STuBSAcGG+meA14K/CI21HcS4LBT6tv0QAh8Dr5l93AhZzG5ZJ4VxAqdZUEl9z7WJ4aN+svMvwHHL21UKTd1mqvChH7/Za5xzXBBKrUcB0TQ+Ulgkfbi/H/YT5EptrGzsEK7tR1B7ln9BBwckYfMiuSqklSznIuoIIOM42MQO+QnduCoFCI0bpkzjCjddHPN/F+2Yu+sd9bKNpVwHhbS3LluK/0zgfwD0xYI5dXuzlQAAAABJRU5ErkJggg==');
  }

  div.callout-warning.callout-style-default .callout-caption {
    background-color: #fcefdc
  }

  div.callout-tip {
    border-left-color: #02b875 !important;
  }

  div.callout-tip .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAADr0lEQVRYCe1XTWgTQRj9ZjZV8a9SPIkKgj8I1bMHsUWrqYLVg4Ue6v9BwZOxSYsIerFao7UiUryIqJcqgtpimhbBXoSCVxUFe9CTiogUrUp2Pt+3aUI2u5vdNh4dmMzOzHvvezuz8xNFM0mjnbXaNu1MvFWRXkXEyE6aYOYJpdW4IXuA4r0fo8qqSMDBU0v1HJUgVieAXxzCsdE/YJTdFcVIZQNMyhruOMJKXYFoLfIfIvVIMWdsrd+Rpd86ZmyzzjJmLStqRn0v8lzkb4rVIXvnpScOJuAn2ACC65FkPzEdEy4TPWRLJ2h7z4cArXzzaOdKlbOvKKX25Wl00jSnrwVxAg3o4dRxhO13RBSdNvH0xSARv3adTXbBdTf64IWO2vH0LT+cv4GR1DJt+DUItaQogeBX/chhbTBxEiZ6gftlDNXTrvT7co4ub5A6gp9HIcHvzTa46OS5fBeP87Qm0fQkr4FsYgVQ7Qg+ZayaDg9jhg1GkWj8RG6lkeSacrrHgDaxdoBiZPg+NXV/KifMuB6//JmYH4CntVEHy/keA6x4h4CU5oFy8GzrBS18cLJMXcljAKB6INjWsRcuZBWVaS3GDrqB7rdapVIeA+isQ57Eev9eCqzqOa81CY05VLd6SamW2wA2H3SiTbnbSxmzfp7WtKZkqy4mdyAlGx7ennghYf8voqp9cLSgKdqNfa6RdRsAAkPwRuJZNbpByn+RrJi1RXTwdi8RQF6ymDwGMAtZ6TVE+4uoKh+MYkcLsT0Hk8eAienbiGdjJHZTpmNjlbFJNKDVAp2fJlYju6IreQxQ08UJDNYdoLSl6AadO+fFuCQqVMB1NJwPm69T04Wv5WhfcWyfXQB+wXRs1pt+nCknRa0LVzSA/2B+a9+zQJadb7IyyV24YAxKp2Jqs3emZTuNnKxsah+uabKbMk7CbTgJx/zIgQYErIeTKRQ9yD9wxVof5YolPHqaWo7TD6tJlh7jQnK5z2n3+fGdggIOx2kaa2YI9QWarc5Ce1ipNWMKeSG4DysFF52KBmTNMmn5HqCFkwy34rDg05gDwgH3bBi+sgFhN/e8QvRn8kbamCOhgrZ9GJhFDgfcMHzFb6BAtjKpFhzTjwv1KCVuxHvCbsSiEz4CANnj84cwHdFXAbAOJ4LTSAawGWFn5tDhLMYz6nWeU2wJfIhmIJBefcd/A5FWQWGgrWzyORZ3Q6HuV+Jf0Bj+BTX69fm1zWgK7By1YTXchFDORywnfQ7GpzOo6S+qECrsx2ifVQAAAABJRU5ErkJggg==');
  }

  div.callout-tip.callout-style-default .callout-caption {
    background-color: #ccf1e3
  }

  div.callout-caution {
    border-left-color: #fd7e14 !important;
  }

  div.callout-caution .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAACV0lEQVRYCdVWzWoUQRCuqp2ICBLJXgITZL1EfQDBW/bkzUMUD7klD+ATSHBEfAIfQO+iXsWDxJsHL96EHAwhgzlkg8nBg25XWb0zIb0zs9muYYWkoKeru+vn664fBqElyZNuyh167NXJ8Ut8McjbmEraKHkd7uAnAFku+VWdb3reSmRV8PKSLfZ0Gjn3a6Xlcq9YGb6tADjn+lUfTXtVmaZ1KwBIvFI11rRXlWlatwIAAv2asaa9mlB9wwygiDX26qaw1yYPzFXg2N1GgG0FMF8Oj+VIx7E/03lHx8UhvYyNZLN7BwSPgekXXLribw7w5/c8EF+DBK5idvDVYtEEwMeYefjjLAdEyQ3M9nfOkgnPTEkYU+sxMq0BxNR6jExrAI31H1rzvLEfRIdgcv1XEdj6QTQAS2wtstEALLG1yEZ3QhH6oDX7ExBSFEkFINXH98NTrme5IOaaA7kIfiu2L8A3qhH9zRbukdCqdsA98TdElyeMe5BI8Rs2xHRIsoTSSVFfCFCWGPn9XHb4cdobRIWABNf0add9jakDjQJpJ1bTXOJXnnRXHRf+dNL1ZV1MBRCXhMbaHqGI1JkKIL7+i8uffuP6wVQAzO7+qVEbF6NbS0LJureYcWXUUhH66nLR5rYmva+2tjRFtojkM2aD76HEGAD3tPtKM309FJg5j/K682ywcWJ3PASCcycH/22u+Bh7Aa0ehM2Fu4z0SAE81HF9RkB21c5bEn4Dzw+/qNOyXr3DCTQDMBOdhi4nAgiFDGCinIa2owCEChUwD8qzd03PG+qdW/4fDzjUMcE1ZpIAAAAASUVORK5CYII=');
  }

  div.callout-caution.callout-style-default .callout-caption {
    background-color: #ffe5d0
  }

  </style>
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
  
  <script src="09_multilevel_files/libs/htmlwidgets-1.6.1/htmlwidgets.js"></script>
  <link href="09_multilevel_files/libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
  <script src="09_multilevel_files/libs/datatables-binding-0.26/datatables.js"></script>
  <script src="09_multilevel_files/libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
  <link href="09_multilevel_files/libs/dt-core-1.12.1/css/jquery.dataTables.min.css" rel="stylesheet">
  <link href="09_multilevel_files/libs/dt-core-1.12.1/css/jquery.dataTables.extra.css" rel="stylesheet">
  <script src="09_multilevel_files/libs/dt-core-1.12.1/js/jquery.dataTables.min.js"></script>
  <link href="09_multilevel_files/libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet">
  <script src="09_multilevel_files/libs/crosstalk-1.2.0/js/crosstalk.min.js"></script>
</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" class="center">
  <h1 class="title">Modern Statistical Computing</h1>
  <p class="subtitle">9. Multilevel models</p>
  <p class="author">David Rossell</p>
  <p class="institute">Pompeu Fabra University</p>
</section><section id="TOC">
<nav role="doc-toc"> 
<h2 id="toc-title">Table of contents</h2>
<ul>
<li><a href="#/motivation" id="/toc-motivation">Motivation</a></li>
<li><a href="#/a-proper-multi-level-model" id="/toc-a-proper-multi-level-model">A proper multi-level model</a></li>
<li><a href="#/statistical-inference" id="/toc-statistical-inference">Statistical inference</a></li>
<li><a href="#/exercise" id="/toc-exercise">Exercise</a></li>
</ul>
</nav>
</section>
<section id="reproducing-these-lecture-notes" class="slide level2">
<h2>Reproducing these lecture notes</h2>
<p>Load required R packages</p>
<div class="cell" data-hash="09_multilevel_cache/revealjs/unnamed-chunk-1_50337aee3f3dd52bba0b8594c87544ab">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(coefplot)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DT)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(GGally)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lme4)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"../code/routines.R"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Disclaimer: these notes borrow heavily from Roback &amp; Legler’s <a href="https://bookdown.org/roback/bookdown-BeyondMLR">Beyond multiple linear regression</a> (free online)</p>
</section>
<section>
<section id="motivation" class="title-slide slide level1 center">
<h1>Motivation</h1>

</section>
<section id="multilevel-models" class="slide level2">
<h2>Multilevel models</h2>
<p>We often encounter data that was collected at multiple levels</p>
<p><strong>Example.</strong> Musician’s performance stress (negative affect score, PANAS questionnaire)</p>
<p>Performance covariates (Level 1)</p>
<ul>
<li><p>Type of performance: solo, small ensemble, large ensembl</p></li>
<li><p>Audience: who attended (instructor, public, students, jury)</p></li>
</ul>
<p>Musician covariates (Level 2)</p>
<ul>
<li><p>Negative emotionality scale from MPQ questionnaire</p></li>
<li><p>Gender, instrument…</p></li>
</ul>
<p>Goal: how does stress depend on emotionality, accounting for other covariates?</p>
<p>Issue: data clearly non-independent</p>
</section>
<section class="slide level2">

<p><code>musicdata.txt</code> has several diary entries for each musician (<code>id</code>). In total, 497 performances by 37 musicians</p>
<div class="cell" data-hash="09_multilevel_cache/revealjs/unnamed-chunk-2_f86d69ff7e3d7e04f5abd45ed872b5a1">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">#convert id to factor, center mpqnem, create Large ensembl indicator</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>music<span class="ot">=</span> <span class="fu">as_tibble</span>(<span class="fu">read.table</span>(<span class="st">"../datasets/musicdata.txt"</span>, <span class="at">header=</span><span class="cn">TRUE</span>)) <span class="sc">|&gt;</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">id=</span> <span class="fu">factor</span>(id), <span class="at">mpqnem=</span> mpqnem<span class="sc">-</span><span class="fu">mean</span>(mpqnem), <span class="at">audience=</span> <span class="fu">ifelse</span>(perform_type<span class="sc">==</span><span class="st">'Large Ensemble'</span>, <span class="st">"large"</span>, <span class="st">"small"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(id, diary, na, mpqnem, audience)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>music</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 497 × 17
   id    diary    na mpqnem audience previous perfor…¹ memory    pa   age gender
   &lt;fct&gt; &lt;int&gt; &lt;int&gt;  &lt;dbl&gt; &lt;chr&gt;       &lt;int&gt; &lt;chr&gt;    &lt;chr&gt;  &lt;int&gt; &lt;int&gt; &lt;chr&gt; 
 1 1         1    11  -15.6 small           0 Solo     Unspe…    40    18 Female
 2 1         2    19  -15.6 large           1 Large E… Memory    33    18 Female
 3 1         3    14  -15.6 large           2 Large E… Memory    49    18 Female
 4 1         4    19  -15.6 small           3 Solo     Memory    41    18 Female
 5 1         5    10  -15.6 small           4 Solo     Memory    31    18 Female
 6 1         6    13  -15.6 small           5 Solo     Memory    33    18 Female
 7 1         7    11  -15.6 small           6 Solo     Memory    34    18 Female
 8 1         8    13  -15.6 small           7 Solo     Memory    43    18 Female
 9 1         9    10  -15.6 small           8 Solo     Score     34    18 Female
10 1        10    10  -15.6 small           9 Solo     Score     45    18 Female
# … with 487 more rows, 6 more variables: instrument &lt;chr&gt;, years_study &lt;int&gt;,
#   mpqab &lt;int&gt;, mpqsr &lt;int&gt;, mpqpem &lt;int&gt;, mpqcon &lt;int&gt;, and abbreviated
#   variable name ¹​perform_type</code></pre>
</div>
</div>
</section>
<section id="other-examples" class="slide level2">
<h2>Other examples</h2>
<p>Two-level models used in many examples</p>
<ul>
<li><p>Housing prices vs.&nbsp;house &amp; neighborhood covariates</p></li>
<li><p>Ambiguity of political tweets made in various districts vs.&nbsp;politician &amp; district covariates</p></li>
</ul>
<p>One can also consider &gt;2 levels, for example</p>
<ul>
<li><p>Student marks vs.&nbsp;student, class &amp; school covariates</p></li>
<li><p>Football player’s salary vs.&nbsp;player, team &amp; league covariates</p></li>
</ul>
<p>We focus on 2 levels for simplicty</p>
</section>
<section id="music-data" class="slide level2">
<h2>Music data</h2>
<p>We focus on</p>
<ul>
<li><p>Negative affect score (outcome): <code>na</code></p></li>
<li><p>Audience size (large vs.&nbsp;small/solo) (Level 1 covariate): <code>Large</code></p></li>
<li><p>Negative emotionality (Level 2 covariate): <code>mpqnem</code></p></li>
</ul>
</section>
<section class="slide level2">

<div class="panel-tabset">
<ul id="tabset-1" class="panel-tabset-tabby"><li><a data-tabby-default="" href="#tabset-1-1">Scatter-plot</a></li><li><a href="#tabset-1-2">Musician id</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1">
<p>We can explore data as usual</p>
<div class="cell" data-hash="09_multilevel_cache/revealjs/unnamed-chunk-3_f20fb3937278c73e00c561d47f7a1247">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(music, <span class="fu">aes</span>(mpqnem, na, <span class="at">color=</span>audience)) <span class="sc">+</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>() <span class="sc">+</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">'Negative emotionality'</span>, <span class="at">y=</span><span class="st">"Stress (negative affect score)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img data-src="09_multilevel_files/figure-revealjs/unnamed-chunk-3-1.png" width="960"></p>
</div>
</div>
</div>
<div id="tabset-1-2">
<p>But recall that data are dependent within a musician</p>
<div class="cell" data-hash="09_multilevel_cache/revealjs/unnamed-chunk-4_da20a43009fd24c077716737ca715f07">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(music, <span class="fu">aes</span>(mpqnem, na, <span class="at">color=</span>id)) <span class="sc">+</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>() <span class="sc">+</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">'Negative emotionality'</span>, <span class="at">y=</span><span class="st">"Stress (negative affect score)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img data-src="09_multilevel_files/figure-revealjs/unnamed-chunk-4-1.png" width="960"></p>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="option-1.-standard-linear-regression" class="slide level2">
<h2>Option 1. Standard linear regression</h2>
<p>The analysis below is wrong. It assumes that all observations are independent, giving too narrow CIs and too small P-values (inflated false positives)</p>
<div class="cell" data-hash="09_multilevel_cache/revealjs/unnamed-chunk-5_c908c08ade507c9bcbe6ff0b210a537f">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>fit1<span class="ot">=</span> <span class="fu">lm</span>(na <span class="sc">~</span> mpqnem <span class="sc">+</span> audience, <span class="at">data=</span>music)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">coefSummary</span>(fit1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  Parameter     Estimate `Conf. Int.`    `P-value`
  &lt;chr&gt;            &lt;dbl&gt; &lt;chr&gt;           &lt;chr&gt;    
1 (Intercept)      15.1  (14.303,15.991) &lt;0.00001 
2 mpqnem            0.15 (0.109,0.191)   &lt;0.00001 
3 audiencesmall     1.46 (0.47,2.455)    0.00395  </code></pre>
</div>
</div>
</section>
<section id="option-2.-two-stage-analysis" class="slide level2">
<h2>Option 2. Two-stage analysis</h2>
<p>Consider fitting a model for each musician at level 1: stress vs.&nbsp;performance type. Note: we can only use musicians with the 3 performance types</p>
<div class="cell" data-hash="09_multilevel_cache/revealjs/unnamed-chunk-6_9d8d2b0e8fb202407692847b95d51b7d">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>fitmodel<span class="ot">=</span> <span class="cf">function</span>(df) {   <span class="co">#Return OLS</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  naudience<span class="ot">=</span> <span class="fu">length</span>(<span class="fu">unique</span>(df<span class="sc">$</span>audience))</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (naudience <span class="sc">==</span> <span class="dv">2</span>) {</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    ans<span class="ot">=</span> <span class="fu">round</span>(<span class="fu">coef</span>(<span class="fu">lm</span>(na <span class="sc">~</span> audience, <span class="at">data=</span>df)),<span class="dv">3</span>)</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>    ans<span class="ot">=</span> <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="dv">2</span>)</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(ans)<span class="ot">=</span> <span class="fu">c</span>(<span class="st">'Intercept'</span>,<span class="st">'small'</span>)</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(ans)</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>music_nest<span class="ot">=</span> <span class="fu">group_by</span>(music, id) <span class="sc">|&gt;</span> <span class="fu">nest</span>() </span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>b1<span class="ot">=</span> <span class="fu">tibble</span>(<span class="at">id=</span>music_nest<span class="sc">$</span>id, <span class="fu">map_df</span>(music_nest<span class="sc">$</span>data, fitmodel))</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>DT<span class="sc">::</span><span class="fu">datatable</span>(b1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">

<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-6993bcbc744570d008e7" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-6993bcbc744570d008e7">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37"],["1","2","3","5","6","7","8","9","10","12","13","15","16","17","18","19","20","21","22","24","25","27","28","29","30","32","33","34","35","36","37","38","39","40","41","42","43"],[16.5,17,12,20,11.75,16.4,15.833,18,13.2,14.667,12,12.25,15.5,20.111,12,12,null,14.6,16.667,17,10.333,17.5,null,14,13,23,null,20,16.75,12.667,11,19,null,null,null,15.333,null],[-4.955,-3.462,1.714,-2.182,1.25,3.2,0.292,-0.875,1.1,4.433,2.273,4.477,7,0.056,1.667,-0,null,2.5,7.833,1.5,7.889,2.5,null,3.667,1.692,-0.154,null,-4.214,1.795,2.222,5.5,-4.286,null,null,null,-0.233,null]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>id<\/th>\n      <th>Intercept<\/th>\n      <th>small<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[2,3]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
<section class="slide level2">

<p>Step 1 coefficients are interpreted as usual</p>
<ul>
<li><p>Intercept: average musician stress (for reference category)</p></li>
<li><p>Small ensembl/Solo: increased stress for small/solo peformance</p></li>
</ul>
<p>Step 2: regress estimates from Step 1 on level 2 covariate (negative emotionality)</p>
<div class="cell" data-hash="09_multilevel_cache/revealjs/unnamed-chunk-7_116748c586d9e13dac9f180f1c9060f8">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>b1<span class="ot">=</span> <span class="fu">unique</span>(<span class="fu">select</span>(music, id, mpqnem)) <span class="sc">|&gt;</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(b1, <span class="at">by=</span><span class="st">'id'</span>)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>b1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 37 × 4
   id    mpqnem Intercept  small
   &lt;fct&gt;  &lt;dbl&gt;     &lt;dbl&gt;  &lt;dbl&gt;
 1 1     -15.6       16.5 -4.96 
 2 2     -10.6       17   -3.46 
 3 3     -10.6       12    1.71 
 4 5       8.37      20   -2.18 
 5 6      -5.63      11.8  1.25 
 6 7      12.4       16.4  3.2  
 7 8      15.4       15.8  0.292
 8 9      -7.63      18   -0.875
 9 10     -4.63      13.2  1.1  
10 12      8.37      14.7  4.43 
# … with 27 more rows</code></pre>
</div>
</div>
</section>
<section class="slide level2">

<div class="panel-tabset">
<ul id="tabset-2" class="panel-tabset-tabby"><li><a data-tabby-default="" href="#tabset-2-1">Intercept</a></li><li><a href="#tabset-2-2">Audience</a></li></ul>
<div class="tab-content">
<div id="tabset-2-1">
<div class="cell" data-hash="09_multilevel_cache/revealjs/unnamed-chunk-8_0901b0961a6c27e0029356067ad2ce41">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coefSummary</span>(<span class="fu">lm</span>(Intercept <span class="sc">~</span> mpqnem, <span class="at">data=</span>b1))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 4
  Parameter   Estimate `Conf. Int.`   `P-value`
  &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt;          &lt;chr&gt;    
1 (Intercept)   15.4   (14.339,16.55) &lt;0.00001 
2 mpqnem         0.121 (0.018,0.224)  0.02314  </code></pre>
</div>
</div>
<div class="cell" data-hash="09_multilevel_cache/revealjs/unnamed-chunk-9_e2180a4647f2824ac8e9f8cdec72b53a">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(b1, <span class="fu">aes</span>(mpqnem, Intercept)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">geom_smooth</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img data-src="09_multilevel_files/figure-revealjs/unnamed-chunk-9-1.png" width="960"></p>
</div>
</div>
</div>
<div id="tabset-2-2">
<div class="cell" data-hash="09_multilevel_cache/revealjs/unnamed-chunk-10_6accec243f5617cd5df9acad545b29c1">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coefSummary</span>(<span class="fu">lm</span>(small <span class="sc">~</span> mpqnem, <span class="at">data=</span>b1))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 4
  Parameter   Estimate `Conf. Int.`   `P-value`
  &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt;          &lt;chr&gt;    
1 (Intercept)     1.53 (0.286,2.769)  0.01774  
2 mpqnem          0.06 (-0.056,0.176) 0.29736  </code></pre>
</div>
</div>
<div class="cell" data-hash="09_multilevel_cache/revealjs/unnamed-chunk-11_81a7e413cecdc63f435502f2d2c40139">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(b1, <span class="fu">aes</span>(mpqnem, small)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">geom_smooth</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img data-src="09_multilevel_files/figure-revealjs/unnamed-chunk-11-1.png" width="960"></p>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="issues" class="slide level2">
<h2>Issues</h2>
<div class="cell" data-hash="09_multilevel_cache/revealjs/unnamed-chunk-12_cc1e86e3df9dc52ac44ec2aa55540d87">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>nmissing<span class="ot">=</span> <span class="fu">sum</span>(<span class="fu">is.na</span>(b1<span class="sc">$</span>Intercept))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The two-step approach suffers from several issues</p>
<ul>
<li><p>Estimates unavailable for some musicians (7 in our example)</p></li>
<li><p>All musicians receive the same weight, regardless of how much data (performances) we have (estimates precision)</p></li>
<li><p>Suboptimal way to share info across musicians</p></li>
</ul>
</section>
<section class="slide level2">

<p>Further subtle but relevant issue <span class="math inline">\((\hat{\beta}_{1i},\hat{\beta}_{2i},\hat{\beta}_{3i})\)</span> for musician <span class="math inline">\(i\)</span> are correlated: using three separate regressions not ideal</p>
<div class="cell" data-hash="09_multilevel_cache/revealjs/unnamed-chunk-13_3e48fafaedeae886eeeb3d005c81a36e">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggpairs</span>(b1[,<span class="fu">c</span>(<span class="st">'Intercept'</span>,<span class="st">'small'</span>)])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>

</div>
<img data-src="09_multilevel_files/figure-revealjs/unnamed-chunk-13-1.png" width="960" class="r-stretch"></section></section>
<section>
<section id="a-proper-multi-level-model" class="title-slide slide level1 center">
<h1>A proper multi-level model</h1>

</section>
<section class="slide level2">

<p>Let <span class="math inline">\(y_{ij}\)</span> be stress for subject <span class="math inline">\(i\)</span> in performance <span class="math inline">\(j\)</span></p>
<p><strong>Level 1:</strong> <span class="math display">\[y_{ij}=  \beta_{0i} + \beta_{1i} \mbox{small}_{ij} + \epsilon_i\]</span></p>
<p><strong>Level 2:</strong> <span class="math display">\[
\begin{aligned}
\beta_{0i}&amp;= \alpha_0 + \alpha_1 \mbox{mpqnem}_i + u_i
\\
\beta_{1i}&amp;= \gamma_0 + v_i
\end{aligned}
\]</span> where <span class="math inline">\(\epsilon_i \sim N(0,\sigma^2)\)</span> and <span class="math inline">\((u_i,v_i) \sim N(0, \Sigma)\)</span> <span class="math display">\[
\Sigma= \begin{pmatrix} \sigma_u^2 &amp; \rho \sigma_u \sigma_v \\ \rho \sigma_u \sigma_v &amp; \sigma_v^2 \end{pmatrix}
\]</span> As discussed, the intercept <span class="math inline">\(\beta_{0i}\)</span> and slope <span class="math inline">\(\beta_{1i}\)</span> may be correlated. Note: one could add mpqnem to the <span class="math inline">\(\beta_{1i}\)</span> regression</p>
</section>
<section id="composite-model" class="slide level2">
<h2>Composite model</h2>
<p>Re-write the model, plugging in the expressions for <span class="math inline">\(\beta_{0i}\)</span> and <span class="math inline">\(\beta_{1i}\)</span> into Level 1</p>
<p><span class="math display">\[
\begin{aligned}
&amp;y_{ij}=  \beta_{0i} + \beta_{1i} \mbox{small}_{ij} + \epsilon_i=
\\
&amp;\alpha_0 + \alpha_1 \mbox{mpqnem}_i + u_i +
(\gamma_0 + v_i) \mbox{small}_{ij} + \epsilon_i=
\\
&amp;\alpha_0 + \alpha_1 \mbox{mpqnem}_i + \gamma_0 \mbox{small}_{ij}
+ u_i + v_i \mbox{small}_{ij} + \epsilon_i
\end{aligned}
\]</span></p>
<ul>
<li><p>Main effects for mpqnem and small</p></li>
<li><p>Random intercept for individual <span class="math inline">\(i\)</span> is <span class="math inline">\(\alpha_0 + u_i\)</span>, random slope is <span class="math inline">\(\gamma_0 + v_i\)</span></p></li>
</ul>
<p>Key points</p>
<ol type="1">
<li><p>If <span class="math inline">\(\alpha_1=0\)</span>, mpqnem has no effect (our primary goal)</p></li>
<li><p><span class="math inline">\((u_i,v_i)\)</span> imply dependent observations within musician <span class="math inline">\(i\)</span></p></li>
</ol>
</section>
<section class="slide level2">

<p>The model can be fit with <code>lmer</code> (package <code>lme4</code>). The formula specifies the composite model (small audience nested within musician)</p>
<div class="cell" data-hash="09_multilevel_cache/revealjs/unnamed-chunk-14_25c50e50af1488f4c81f4773557dc12e">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>fit2<span class="ot">=</span> <span class="fu">lmer</span>(na <span class="sc">~</span> mpqnem <span class="sc">+</span> audience <span class="sc">+</span> (audience <span class="sc">|</span> id), <span class="at">REML=</span><span class="cn">TRUE</span>, <span class="at">data=</span>music)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Linear mixed model fit by REML ['lmerMod']
Formula: na ~ mpqnem + audience + (audience | id)
   Data: music

REML criterion at convergence: 2983.5

Scaled residuals: 
    Min      1Q  Median      3Q     Max 
-2.0844 -0.6514 -0.1631  0.5024  4.0155 

Random effects:
 Groups   Name          Variance Std.Dev. Corr
 id       (Intercept)    2.5416  1.5942       
          audiencesmall  0.3123  0.5588   0.29
 Residual               21.8055  4.6696       
Number of obs: 497, groups:  id, 37

Fixed effects:
              Estimate Std. Error t value
(Intercept)    14.9311     0.5091  29.330
mpqnem          0.1480     0.0338   4.379
audiencesmall   1.7759     0.5279   3.364

Correlation of Fixed Effects:
            (Intr) mpqnem
mpqnem      -0.079       
audiencsmll -0.706  0.093</code></pre>
</div>
</div>
</section>
<section class="slide level2">

<p>Estimates similar to least-squares, but CIs usually wider</p>
<div class="cell" data-hash="09_multilevel_cache/revealjs/unnamed-chunk-15_ef18f6b8b23a8f796c26823a5c5f2eaa">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">multiplot</span>(fit1, fit2, <span class="at">intercept=</span><span class="cn">FALSE</span>, <span class="at">names=</span><span class="fu">c</span>(<span class="st">"Ordinary least-squares"</span>,<span class="st">"Multilevel model"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="09_multilevel_files/figure-revealjs/unnamed-chunk-15-1.png" width="960" class="r-stretch"></section>
<section class="slide level2">

<p>We can extract inference as usual</p>
<div class="panel-tabset">
<ul id="tabset-3" class="panel-tabset-tabby"><li><a data-tabby-default="" href="#tabset-3-1">Fixed effects</a></li><li><a href="#tabset-3-2">Conf. int</a></li></ul>
<div class="tab-content">
<div id="tabset-3-1">
<div class="cell" data-hash="09_multilevel_cache/revealjs/unnamed-chunk-16_a2068e6f5d24d7af6fc0d1214fec8984">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit2)<span class="sc">$</span>coef</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                Estimate Std. Error   t value
(Intercept)   14.9311446 0.50907883 29.329730
mpqnem         0.1479837 0.03379694  4.378613
audiencesmall  1.7758728 0.52787590  3.364186</code></pre>
</div>
</div>
</div>
<div id="tabset-3-2">
<div class="cell" data-hash="09_multilevel_cache/revealjs/unnamed-chunk-17_eee3835d8a784784053b4ccef09b5d17">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">confint</span>(fit2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                    2.5 %     97.5 %
.sig01         0.63392735  2.3356500
.sig02        -1.00000000  1.0000000
.sig03         0.00000000  1.4137562
.sigma         4.38430474  4.9853094
(Intercept)   13.91111139 15.9107523
mpqnem         0.08113646  0.2145665
audiencesmall  0.74974164  2.7958929</code></pre>
</div>
</div>
<section id="random-effects" class="slide level2">
<h2>Random effects</h2>
<div class="cell" data-hash="09_multilevel_cache/revealjs/unnamed-chunk-18_a82200f5c6ec08853eb01a4629106df1">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(fit2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$id
   (Intercept)    mpqnem audiencesmall
1     13.92498 0.1479837      1.455107
2     14.24290 0.1479837      1.584644
3     14.10146 0.1479837      1.614089
5     15.04837 0.1479837      1.755218
6     13.28839 0.1479837      1.476762
7     15.00823 0.1479837      1.843930
8     13.60393 0.1479837      1.510190
9     16.64485 0.1479837      1.915102
10    14.02624 0.1479837      1.600954
12    15.23267 0.1479837      1.901696
13    14.06361 0.1479837      1.644792
15    14.46416 0.1479837      1.789776
16    15.10116 0.1479837      1.885869
17    18.14587 0.1479837      2.141913
18    13.78316 0.1479837      1.613648
19    14.03576 0.1479837      1.582296
20    15.18486 0.1479837      1.827277
21    14.26927 0.1479837      1.696042
22    16.76469 0.1479837      2.291188
24    15.47023 0.1479837      1.837804
25    16.03228 0.1479837      2.210039
27    15.33897 0.1479837      1.827904
28    14.54096 0.1479837      1.696819
29    15.76649 0.1479837      1.978593
30    14.59642 0.1479837      1.710101
32    17.37930 0.1479837      2.191847
33    15.63331 0.1479837      1.918135
34    14.95686 0.1479837      1.714348
35    16.44705 0.1479837      2.035726
36    12.50227 0.1479837      1.413915
37    15.74991 0.1479837      1.976206
38    14.76547 0.1479837      1.676393
39    15.67268 0.1479837      1.926111
40    15.18742 0.1479837      1.827796
41    12.58195 0.1479837      1.299913
42    13.66114 0.1479837      1.497690
43    15.23511 0.1479837      1.837458

attr(,"class")
[1] "coef.mer"</code></pre>
</div>
</div>
</section>
</div>
</div>
</div>
</section>
<section id="generalized-linear-mixed-models" class="slide level2">
<h2>Generalized linear mixed models</h2>
<p>Multilevel models extend directly to GLMs, e.g.&nbsp;logistic or Poisson regression</p>
<ul>
<li><p>Function <code>glmer</code></p></li>
<li><p>Argument <code>family</code></p></li>
</ul>
</section></section>
<section>
<section id="statistical-inference" class="title-slide slide level1 center">
<h1>Statistical inference</h1>

</section>
<section id="parameter-estimation" class="slide level2">
<h2>Parameter estimation</h2>
<p><span class="math display">\[
y_{ij}= \alpha_0 + \alpha_1 \mbox{mpqnem}_i + \gamma_0 \mbox{small}_{ij}
+ u_i + v_i \mbox{small}_{ij} + \epsilon_i \mbox{, } (\epsilon_i, u_i, v_i) \sim N(0,\Sigma)
\]</span></p>
<ul>
<li><p>Fixed effects: <span class="math inline">\(\alpha_0, \alpha_1, \gamma_0\)</span>, variance components: <span class="math inline">\(\Sigma\)</span></p></li>
<li><p>Random effects: <span class="math inline">\(u=(u_1,\ldots,u_n)\)</span>, <span class="math inline">\(v=(v_1,\ldots,v_n)\)</span></p></li>
</ul>
<p>Two popular criteria to fit multilevel models</p>
<ul>
<li><p>MLE: <span class="math inline">\(\max p(y \mid \alpha_0, \alpha_1, \gamma_0, \Sigma, u, v)\)</span></p></li>
<li><p>Restricted MLE: first <span class="math inline">\(\max_{\alpha, \gamma, \Sigma} p(y \mid \alpha_0, \alpha_1, \gamma_0, \Sigma)\)</span>, then <span class="math display">\[
\max_{u,v} p(y \mid \hat{\alpha}_0, \hat{\alpha}_1, \hat{\gamma}_0, \hat{\Sigma}, u, v)
\]</span></p></li>
</ul>
</section>
<section id="mle-vs-rmle" class="slide level2">
<h2>MLE vs RMLE</h2>
<p>MLE a bit worse than RMLE (default in <code>lmer</code>)</p>
<ul>
<li><p>Larger estimation error for fixed effects</p></li>
<li><p>Biased for variance components (under-estimation)</p></li>
<li><p>But, MLE allows testing the removal of fixed effects via likelihood-ratio test</p></li>
</ul>
<p>Testing the removal of random effects is a bit more complex</p>
</section>
<section id="testing-fixed-effects" class="slide level2">
<h2>Testing fixed effects</h2>
<p>As with GLMs, <code>anova</code> tests whether fixed effects can be removed (it uses MLE internally). We also get AIC and BIC.</p>
<div class="cell" data-hash="09_multilevel_cache/revealjs/unnamed-chunk-19_1102a70480550c43d850ffcefd5968ba">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>fit2<span class="ot">=</span> <span class="fu">lmer</span>(na <span class="sc">~</span> mpqnem <span class="sc">+</span> audience <span class="sc">+</span> (audience <span class="sc">|</span> id), <span class="at">REML=</span><span class="cn">TRUE</span>, <span class="at">data=</span>music)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="09_multilevel_cache/revealjs/unnamed-chunk-20_5910d73f0e0fbadb45eefd056ec70876">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>fit3<span class="ot">=</span> <span class="fu">lmer</span>(na <span class="sc">~</span> audience <span class="sc">+</span> (audience <span class="sc">|</span> id), <span class="at">REML=</span><span class="cn">TRUE</span>, <span class="at">data=</span>music)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(fit2, fit3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Data: music
Models:
fit3: na ~ audience + (audience | id)
fit2: na ~ mpqnem + audience + (audience | id)
     npar    AIC    BIC  logLik deviance  Chisq Df Pr(&gt;Chisq)    
fit3    6 3006.8 3032.0 -1497.4   2994.8                         
fit2    7 2992.8 3022.3 -1489.4   2978.8 15.928  1  6.578e-05 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
</section>
<section id="testing-variance-components" class="slide level2">
<h2>Testing variance components</h2>
<p>Since random slopes for audience have small variance, consider a model where only the intercept is random (same effect for small audience across individuals)</p>
<div class="panel-tabset">
<ul id="tabset-4" class="panel-tabset-tabby"><li><a data-tabby-default="" href="#tabset-4-1">Random intercept &amp; slope</a></li><li><a href="#tabset-4-2">Random intercept</a></li></ul>
<div class="tab-content">
<div id="tabset-4-1">
<div class="cell" data-hash="09_multilevel_cache/revealjs/unnamed-chunk-21_f8b21201521f7c279fc83c3c51be9c61">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>fit2<span class="ot">=</span> <span class="fu">lmer</span>(na <span class="sc">~</span> mpqnem <span class="sc">+</span> audience <span class="sc">+</span> (audience <span class="sc">|</span> id), <span class="at">REML=</span><span class="cn">TRUE</span>, <span class="at">data=</span>music)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="09_multilevel_cache/revealjs/unnamed-chunk-22_c40db369cd30f7b01a8d6a4f8743ca52">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Linear mixed model fit by REML ['lmerMod']
Formula: na ~ mpqnem + audience + (audience | id)
   Data: music

REML criterion at convergence: 2983.5

Scaled residuals: 
    Min      1Q  Median      3Q     Max 
-2.0844 -0.6514 -0.1631  0.5024  4.0155 

Random effects:
 Groups   Name          Variance Std.Dev. Corr
 id       (Intercept)    2.5416  1.5942       
          audiencesmall  0.3123  0.5588   0.29
 Residual               21.8055  4.6696       
Number of obs: 497, groups:  id, 37

Fixed effects:
              Estimate Std. Error t value
(Intercept)    14.9311     0.5091  29.330
mpqnem          0.1480     0.0338   4.379
audiencesmall   1.7759     0.5279   3.364

Correlation of Fixed Effects:
            (Intr) mpqnem
mpqnem      -0.079       
audiencsmll -0.706  0.093</code></pre>
</div>
</div>
</div>
<div id="tabset-4-2">
<div class="cell" data-hash="09_multilevel_cache/revealjs/unnamed-chunk-23_1325a49e269ee763a374bcfe1db8b6b0">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>fit4<span class="ot">=</span> <span class="fu">lmer</span>(na <span class="sc">~</span> mpqnem <span class="sc">+</span> audience <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> id), <span class="at">REML=</span><span class="cn">TRUE</span>, <span class="at">data=</span>music)</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit4)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Linear mixed model fit by REML ['lmerMod']
Formula: na ~ mpqnem + audience + (1 | id)
   Data: music

REML criterion at convergence: 2983.7

Scaled residuals: 
    Min      1Q  Median      3Q     Max 
-2.0809 -0.6697 -0.1606  0.4884  3.9834 

Random effects:
 Groups   Name        Variance Std.Dev.
 id       (Intercept)  3.019   1.738   
 Residual             21.880   4.678   
Number of obs: 497, groups:  id, 37

Fixed effects:
              Estimate Std. Error t value
(Intercept)   14.90570    0.52515  28.383
mpqnem         0.15032    0.03358   4.476
audiencesmall  1.79055    0.52380   3.418

Correlation of Fixed Effects:
            (Intr) mpqnem
mpqnem      -0.071       
audiencsmll -0.730  0.089</code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="testing-variance-components-1" class="slide level2">
<h2>Testing variance components</h2>
<p>Random slopes <span class="math inline">\(v_i \sim N(0, \sigma_v^2)\)</span>, test the null hypothesis <span class="math inline">\(H_0: \sigma_v^2\)</span></p>
<p>Likelihood-ratio test has a complex asymptotic distribution (not <span class="math inline">\(\chi^2\)</span>)</p>
<p>Better to use a “parametric Boostrap test”</p>
<ol type="1">
<li><p>Fit the null model (e.g.&nbsp;no random slopes). Use it to simulate many datasets</p></li>
<li><p>For each dataset, fit the larger model &amp; compute the likelihood-ratio test statistic</p></li>
<li><p>P-value: proportion of simulated LRTs &gt; observed data LRT</p></li>
</ol>
</section>
<section class="slide level2">

<p>Easy to do in R: function <code>bootstrapAnova</code>. Below only <code>B=100</code> samples are used so that it runs fast, in practice you want at least 1000</p>
<div class="cell" data-hash="09_multilevel_cache/revealjs/unnamed-chunk-24_0ca0e48f7d6249f380aa7f327dece955">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bootstrapAnova</span>(<span class="at">modelA=</span> fit2, <span class="at">model0=</span> fit4, <span class="at">B=</span><span class="dv">100</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Data: music
Parametric bootstrap with 100 samples.
Models:
model0: na ~ mpqnem + audience + (1 | id)
modelA: na ~ mpqnem + audience + (audience | id)
       npar    AIC    BIC  logLik deviance  Chisq Df Pr_boot(&gt;Chisq)
model0    5 2989.0 3010.1 -1489.5   2979.0                          
modelA    7 2992.8 3022.3 -1489.4   2978.8 0.1997  2            0.71</code></pre>
</div>
</div>
<p>What model do the AIC/BIC favor? According to BIC, can we drop the random intercept?</p>
<div class="cell" data-hash="09_multilevel_cache/revealjs/unnamed-chunk-25_7050d38bbc01ae51d8f6cacce45f5e72">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>fit5<span class="ot">=</span> <span class="fu">lm</span>(na <span class="sc">~</span> mpqnem <span class="sc">+</span> audience, <span class="at">data=</span>music)</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="fu">BIC</span>(fit5)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3027.338</code></pre>
</div>
</div>
</section></section>
<section>
<section id="exercise" class="title-slide slide level1 center">
<h1>Exercise</h1>

</section>
<section class="slide level2">

<p>Consider 4 covariates</p>
<ul>
<li><p>Level 1. <code>audience</code> (small/large), <code>bymemory</code> (played by memory)</p></li>
<li><p>Level 2. <code>mpqnem</code> (negative emotionality score)</p></li>
</ul>
<p>Fit a model with fixed effects for all 3 covariates, and random slopes for <code>audience</code> and <code>bymemory</code></p>
<ul>
<li><p>Interpret the estimated fixed effect of <code>bymemory</code>. What association with stress does it suggest?</p></li>
<li><p>Is <code>bymemory</code> significantly associated with stress?</p></li>
</ul>
<p>Getting started</p>
<div class="cell" data-hash="09_multilevel_cache/revealjs/unnamed-chunk-26_94fdf86f83e05a889022c0cecee1d66d">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lme4)</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"../code/routines.R"</span>)</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>music<span class="ot">=</span> <span class="fu">as_tibble</span>(<span class="fu">read.table</span>(<span class="st">"~/github/statcomp/datasets/musicdata.txt"</span>, <span class="at">header=</span><span class="cn">TRUE</span>)) <span class="sc">|&gt;</span></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">id=</span> <span class="fu">factor</span>(id), <span class="at">mpqnem=</span> mpqnem<span class="sc">-</span><span class="fu">mean</span>(mpqnem), <span class="at">audience=</span> <span class="fu">ifelse</span>(perform_type<span class="sc">==</span><span class="st">'Large Ensemble'</span>, <span class="st">"large"</span>, <span class="st">"small"</span>), <span class="at">bymemory=</span> <span class="fu">ifelse</span>(memory<span class="sc">==</span><span class="st">'Memory'</span>,<span class="dv">1</span>,<span class="dv">0</span>) ) <span class="sc">|&gt;</span></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(id, diary, na, mpqnem, audience)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="footer footer-default">

</div>
</section></section>
    </div>
  </div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="09_multilevel_files/libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="09_multilevel_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="09_multilevel_files/libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="09_multilevel_files/libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="09_multilevel_files/libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="09_multilevel_files/libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="09_multilevel_files/libs/revealjs/plugin/notes/notes.js"></script>
  <script src="09_multilevel_files/libs/revealjs/plugin/search/search.js"></script>
  <script src="09_multilevel_files/libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="09_multilevel_files/libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': false,
'smaller': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: false,

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: true,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'none',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1050,

        height: 700,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    
    <script>
      // htmlwidgets need to know to resize themselves when slides are shown/hidden.
      // Fire the "slideenter" event (handled by htmlwidgets.js) when the current
      // slide changes (different for each slide format).
      (function () {
        // dispatch for htmlwidgets
        function fireSlideEnter() {
          const event = window.document.createEvent("Event");
          event.initEvent("slideenter", true, true);
          window.document.dispatchEvent(event);
        }

        function fireSlideChanged(previousSlide, currentSlide) {
          fireSlideEnter();

          // dispatch for shiny
          if (window.jQuery) {
            if (previousSlide) {
              window.jQuery(previousSlide).trigger("hidden");
            }
            if (currentSlide) {
              window.jQuery(currentSlide).trigger("shown");
            }
          }
        }

        // hookup for slidy
        if (window.w3c_slidy) {
          window.w3c_slidy.add_observer(function (slide_num) {
            // slide_num starts at position 1
            fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);
          });
        }

      })();
    </script>

    <script id="quarto-html-after-body" type="application/javascript">
    window.document.addEventListener("DOMContentLoaded", function (event) {
      const toggleBodyColorMode = (bsSheetEl) => {
        const mode = bsSheetEl.getAttribute("data-mode");
        const bodyEl = window.document.querySelector("body");
        if (mode === "dark") {
          bodyEl.classList.add("quarto-dark");
          bodyEl.classList.remove("quarto-light");
        } else {
          bodyEl.classList.add("quarto-light");
          bodyEl.classList.remove("quarto-dark");
        }
      }
      const toggleBodyColorPrimary = () => {
        const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
        if (bsSheetEl) {
          toggleBodyColorMode(bsSheetEl);
        }
      }
      toggleBodyColorPrimary();  
      const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
      tabsets.forEach(function(tabset) {
        const tabby = new Tabby('#' + tabset.id);
      });
      const clipboard = new window.ClipboardJS('.code-copy-button', {
        target: function(trigger) {
          return trigger.previousElementSibling;
        }
      });
      clipboard.on('success', function(e) {
        // button target
        const button = e.trigger;
        // don't keep focus
        button.blur();
        // flash "checked"
        button.classList.add('code-copy-button-checked');
        var currentTitle = button.getAttribute("title");
        button.setAttribute("title", "Copied!");
        let tooltip;
        if (window.bootstrap) {
          button.setAttribute("data-bs-toggle", "tooltip");
          button.setAttribute("data-bs-placement", "left");
          button.setAttribute("data-bs-title", "Copied!");
          tooltip = new bootstrap.Tooltip(button, 
            { trigger: "manual", 
              customClass: "code-copy-button-tooltip",
              offset: [0, -8]});
          tooltip.show();    
        }
        setTimeout(function() {
          if (tooltip) {
            tooltip.hide();
            button.removeAttribute("data-bs-title");
            button.removeAttribute("data-bs-toggle");
            button.removeAttribute("data-bs-placement");
          }
          button.setAttribute("title", currentTitle);
          button.classList.remove('code-copy-button-checked');
        }, 1000);
        // clear code selection
        e.clearSelection();
      });
      function tippyHover(el, contentFn) {
        const config = {
          allowHTML: true,
          content: contentFn,
          maxWidth: 500,
          delay: 100,
          arrow: false,
          appendTo: function(el) {
              return el.closest('section.slide') || el.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'quarto-reveal',
          placement: 'bottom-start'
        };
          config['offset'] = [0,0];
          config['maxWidth'] = 700;
        window.tippy(el, config); 
      }
      const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
      for (var i=0; i<noterefs.length; i++) {
        const ref = noterefs[i];
        tippyHover(ref, function() {
          // use id or data attribute instead here
          let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
          try { href = new URL(href).hash; } catch {}
          const id = href.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          return note.innerHTML;
        });
      }
      const findCites = (el) => {
        const parentEl = el.parentElement;
        if (parentEl) {
          const cites = parentEl.dataset.cites;
          if (cites) {
            return {
              el,
              cites: cites.split(' ')
            };
          } else {
            return findCites(el.parentElement)
          }
        } else {
          return undefined;
        }
      };
      var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
      for (var i=0; i<bibliorefs.length; i++) {
        const ref = bibliorefs[i];
        const citeInfo = findCites(ref);
        if (citeInfo) {
          tippyHover(citeInfo.el, function() {
            var popup = window.document.createElement('div');
            citeInfo.cites.forEach(function(cite) {
              var citeDiv = window.document.createElement('div');
              citeDiv.classList.add('hanging-indent');
              citeDiv.classList.add('csl-entry');
              var biblioDiv = window.document.getElementById('ref-' + cite);
              if (biblioDiv) {
                citeDiv.innerHTML = biblioDiv.innerHTML;
              }
              popup.appendChild(citeDiv);
            });
            return popup.innerHTML;
          });
        }
      }
    });
    </script>
    

</body></html>